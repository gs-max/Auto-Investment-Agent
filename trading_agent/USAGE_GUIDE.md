# 使用指南

## 🔄 功能1: 持续运行模式

### 默认行为
Agent **默认持续运行**，直到你手动停止（按 Ctrl+C）。

### 运行示例

```bash
# 默认：每5分钟检查一次市场
python main.py

# 自定义间隔：每1分钟检查
python main.py --interval 60

# 自定义间隔：每30秒检查（快速测试）
python main.py --interval 30
```

### 运行日志示例

```
🚀 LangGraph 自动交易 Agent 启动
============================================================
💰 账户实际余额: $999.00 USDC
🔒 Agent可用资金: $100.00 USDC (受限)
📊 资金使用率: 10.0%
============================================================
⚠️  模拟模式：不会执行真实交易
🔄 持续运行模式，检查间隔: 300 秒
按 Ctrl+C 可随时停止

【第 1 轮检查】
==================================================
🚀 开始新的交易周期
==================================================
📊 获取市场数据...
💼 获取账户状态...
🤖 LLM 分析市场...
⚠️  风险检查...
💰 执行交易...

==================================================
📋 交易周期总结
==================================================
💰 账户总价值: $999.00
🔒 可用资金: $100.00 (受限)
📊 当前持仓: 0 个

🤔 决策: HOLD
✅ 风险检查: ✅ 通过

⚠️  风险提示:
   - 账户有$999.00，但仅使用$100.00
   - 真实交易未启用，将仅执行模拟
==================================================

⏱️  等待 300 秒后进行下一轮检查...

【第 2 轮检查】
...
```

### 停止 Agent

按 **Ctrl+C** 即可安全停止：

```
^C
============================================================
👋 用户手动停止 (共运行 5 轮)
============================================================
```

---

## 💰 功能2: 资金使用限制

### 需求场景
- 测试网账户有 **999 USDC**
- 但你只想让 Agent 使用 **100 USDC**
- 剩余 899 USDC 作为安全缓冲

### 配置方法

在 `config/config.json` 中设置：

```json
{
  "risk": {
    "max_usable_capital": 100
  }
}
```

### 工作原理

1. **仓位计算**：基于 100 USDC 而非 999 USDC
   - 单币种最大仓位 10% = $10
   - 总持仓限制 50% = $50

2. **风险检查**：所有风险检查使用有效资金
   ```
   实际账户: $999 USDC
   有效资金: $100 USDC  ← 用于风险计算
   ```

3. **日志显示**：清楚标注限制
   ```
   💰 账户总价值: $999.00
   🔒 可用资金: $100.00 (受限)
   ```

### 示例：买入检查

假设 BTC 价格 $50,000，想买入 0.01 BTC：

```python
# 交易价值
trade_value = 0.01 * 50000 = $500

# 检查仓位占比（使用有效资金100）
position_ratio = 500 / 100 = 500%

# 结果：❌ 超过限制（10%）
```

### 调整资金限制

```json
// 更保守：只用50 USDC
{
  "risk": {
    "max_usable_capital": 50
  }
}

// 更激进：用200 USDC
{
  "risk": {
    "max_usable_capital": 200
  }
}

// 无限制：使用全部资金
{
  "risk": {
    "max_usable_capital": null  // 或删除此行
  }
}
```

---

## 🎯 实际使用建议

### 第1周：观察模式（100 USDC限制）

```json
{
  "risk": {
    "max_usable_capital": 100,
    "enable_execution": false  // 只模拟
  },
  "agent": {
    "check_interval": 300  // 5分钟
  }
}
```

**行动**：
- 运行 `python main.py`
- 观察 LLM 的决策
- 查看日志 `tail -f logs/trading.log`
- 让它运行几天

### 第2周：小额真实（50 USDC限制）

```json
{
  "risk": {
    "max_usable_capital": 50,
    "max_single_trade_value": 10,  // 单笔最多$10
    "enable_execution": true  // 开启真实交易
  }
}
```

**行动**：
- 降低可用资金到 50 USDC
- 严格限制单笔交易
- 每天检查一次结果

### 第3周：逐步增加

根据表现逐步提高：
- 50 → 100 → 200 USDC

---

## 📊 监控和日志

### 实时监控

```bash
# 终端1: 运行Agent
python main.py

# 终端2: 实时查看日志
tail -f logs/trading.log
```

### 检查关键信息

每轮检查后，日志会显示：

```
💰 账户总价值: $999.00    ← 实际余额
🔒 可用资金: $100.00 (受限) ← Agent可用
📊 当前持仓: 1 个          ← 持仓数量

🤔 决策: BUY              ← LLM决策
✅风险检查: ✅ 通过        ← 是否通过

⚠️  风险提示:
   - 账户有$999.00，但仅使用$100.00
   - 真实交易未启用，将仅执行模拟
```

---

## ⚠️ 常见问题

### Q1: 如何确认资金限制生效？

**A**: 查看启动日志：
```
💰 账户实际余额: $999.00 USDC
🔒 Agent可用资金: $100.00 USDC (受限)
📊 资金使用率: 10.0%
```

### Q2: Agent 会用完全部 999 USDC 吗？

**A**: 不会！设置 `max_usable_capital: 100` 后，所有风险计算都基于 100 USDC。

### Q3: 如何停止 Agent？

**A**: 按 `Ctrl+C`，会安全退出并显示运行轮次。

### Q4: 间隔时间太长/太短怎么办？

**A**: 修改配置或启动参数：
```bash
# 配置文件
"check_interval": 60  // 1分钟

# 或命令行
python main.py --interval 60
```

### Q5: 如何测试不同策略？

**A**: 编辑 `config/strategy_prompt.txt`，保存后重启 Agent。

---

## 🚀 快速命令参考

```bash
# 持续运行（默认5分钟间隔）
python main.py

# 持续运行（1分钟间隔）
python main.py --interval 60

# 单次运行（测试）
python main.py --mode once

# 查看实时日志
tail -f logs/trading.log

# 停止Agent
Ctrl+C
```

---

**祝使用愉快！记住：从小额开始，逐步增加！**
